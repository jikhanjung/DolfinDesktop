<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Kakao 지도</title>
</head>
<body>
	<div id="map" style="height:98vh;width:98vw"></div>
	<script type="text/javascript" src="jquery-3.5.1.min.js"></script>
	<script type="text/javascript" src="http://dapi.kakao.com/v2/maps/sdk.js?appkey=d77a7932b44514f9642821b2c24b2b50"></script>
	<script type="text/javascript" src="fin_data.js"></script>
	<script>
		var lan = 33.286175;
		var lon = 126.16297166666666;
		var container = document.getElementById('map');
		var options = {
			center: new kakao.maps.LatLng(lan, lon),
			level: 9
		};

		var map = new kakao.maps.Map(container, options);
		var zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

// 마커가 표시될 위치입니다 
var markerPosition  = new kakao.maps.LatLng(lan, lon);

// 마커를 생성합니다
var marker = new kakao.maps.Marker({
    position: markerPosition
});

// 마커가 지도 위에 표시되도록 설정합니다
marker.setMap(map);

var iwContent = '<div style="padding:5px;">JTA001</div>', // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
    iwPosition = new kakao.maps.LatLng(lan, lon); //인포윈도우 표시 위치입니다

// 인포윈도우를 생성합니다
var infowindow = new kakao.maps.InfoWindow({
    position : iwPosition, 
    content : iwContent 
});
  
// 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
//infowindow.open(map); 

var lat_sum=0, lon_sum=0, data_count=0;
var lat_max=0, lat_min=999, lon_max=0, lon_min=999;
var key_list = Object.keys(finid_hash);
var marker_hash = {};
var bounds = new kakao.maps.LatLngBounds(); 

for(key_idx=0;key_idx<key_list.length;key_idx++) {
	
}


for(key_idx=0;key_idx<key_list.length;key_idx++){
	var fin_data = finid_hash[key_list[key_idx]];
	var marker_list = [];
	for(idx=0;idx<fin_data.length;idx++){
		var marker_pos  = new kakao.maps.LatLng(fin_data[idx]['latitude'], fin_data[idx]['longitude']);
		if( fin_data[idx]['latitude'] > 0 ){
			lat = fin_data[idx]['latitude']
			lon = fin_data[idx]['longitude']
			lat_sum += lat;
			lon_sum += lon;
			if( lat_max < lat ) { lat_max = lat; }
			if( lon_max < lon ) { lon_max = lon; }
			if( lat_min > lat ) { lat_min = lat; }
			if( lon_min > lon ) { lon_min = lon; }
			data_count += 1;
			var marker_instance = new kakao.maps.Marker({position: marker_pos});
			var content = '<div class="label">' + key_list[key_idx]+'</div>';
			var overlay_instance = new kakao.maps.CustomOverlay({
				position: marker_pos,
				content: content,
				marker: marker_instance
			});	
			marker_instance.setMap(map);
			overlay_instance.setMap(map);
			marker_list[marker_list.length] = [marker_instance, overlay_instance];
			bounds.extend(marker_pos);
		}
	}
	marker_hash[key_list[key_idx]] = marker_list;
}

var lat_avr = lat_sum / data_count;
var lon_avr = lon_sum / data_count;
//alert( lat_min + ', ' + lon_min + ', ' + lat_max + ', ' + lon_max );
//var map_bound = kakao.maps.LatLngBounds( sw, ne );
//alert(lat_avr + ', ' + lon_avr);
//map.setCenter(new kakao.maps.LatLng(lat_avr, lon_avr));
map.setBounds(bounds);
//alert(fin1_data.length);
	</script>
</body>
</html>